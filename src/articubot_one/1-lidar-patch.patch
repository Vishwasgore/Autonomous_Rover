From b3f25332dde2a15829c873c0df63f2addfefc16f Mon Sep 17 00:00:00 2001
From: Josh Newans <josh.newans@gmail.com>
Date: Sat, 28 May 2022 18:30:22 +1000
Subject: [PATCH] Add simulated lidar

---
 description/lidar.xacro      | 61 ++++++++++++++++++++++++++++++++++++
 description/robot.urdf.xacro |  1 +
 description/robot_core.xacro |  4 +++
 3 files changed, 66 insertions(+)
 create mode 100644 description/lidar.xacro

diff --git a/description/lidar.xacro b/description/lidar.xacro
new file mode 100644
index 00000000..59dc8348
--- /dev/null
+++ b/description/lidar.xacro
@@ -0,0 +1,61 @@
+<?xml version="1.0"?>
+<robot xmlns:xacro="http://www.ros.org/wiki/xacro" >
+
+    <joint name="laser_joint" type="fixed">
+        <parent link="chassis"/>
+        <child link="laser_frame"/>
+        <origin xyz="0.1 0 0.175" rpy="0 0 0"/>
+    </joint>
+
+    <link name="laser_frame">
+        <visual>
+            <geometry>
+                <cylinder radius="0.05" length="0.04"/>
+            </geometry>
+            <material name="red"/>
+        </visual>
+        <collision>
+            <geometry>
+                <cylinder radius="0.05" length="0.04"/>
+            </geometry>
+        </collision>
+        <xacro:inertial_cylinder mass="0.1" length="0.04" radius="0.05">
+            <origin xyz="0 0 0" rpy="0 0 0"/>
+        </xacro:inertial_cylinder>
+    </link>
+
+
+
+    <gazebo reference="laser_frame">
+        <material>Gazebo/Red</material>
+
+        <sensor name="laser" type="ray">
+            <pose> 0 0 0 0 0 0 </pose>
+            <visualize>true</visualize>
+            <update_rate>10</update_rate>
+            <ray>
+                <scan>
+                    <horizontal>
+                        <samples>360</samples>
+                        <resolution>1</resolution>
+                        <min_angle>-3.14</min_angle>
+                        <max_angle>3.14</max_angle>
+                    </horizontal>
+                </scan>
+                <range>
+                    <min>0.3</min>
+                    <max>12</max>
+                    <resolution>0.01</resolution>
+                </range>
+            </ray>
+            <plugin name="laser_controller" filename="libgazebo_ros_ray_sensor.so">
+                <ros>
+                    <argument>~/out:=scan</argument>
+                </ros>
+                <output_type>sensor_msgs/LaserScan</output_type>
+                <frame_name>laser_frame</frame_name>
+            </plugin>
+        </sensor>
+    </gazebo>
+
+</robot>
\ No newline at end of file
diff --git a/description/robot.urdf.xacro b/description/robot.urdf.xacro
index 17b44a7e..eed3c849 100644
--- a/description/robot.urdf.xacro
+++ b/description/robot.urdf.xacro
@@ -4,5 +4,6 @@
     <xacro:include filename="robot_core.xacro" />
 
     <xacro:include filename="gazebo_control.xacro" />
+    <xacro:include filename="lidar.xacro" />
     
 </robot>
\ No newline at end of file
diff --git a/description/robot_core.xacro b/description/robot_core.xacro
index 450432b1..bb5d61b9 100644
--- a/description/robot_core.xacro
+++ b/description/robot_core.xacro
@@ -19,6 +19,10 @@
         <color rgba="0 0 0 1"/>
     </material>
 
+    <material name="red">
+        <color rgba="1 0 0 1"/>
+    </material>
+
     <!-- BASE LINK -->
 
     <link name="base_link">
